<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GATE EEE Tracker â€” Power Systems â†’ Machines</title>
<style>
:root{
  --accent:#0078d7; --bg:#f6f9fa; --card:#fff; --border:#d0d3db; --text:#222;
  --grand:#ffe5b6; --ok:#36d07b; --warn:#ffb86b; --bad:#ff6b6b;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--text);padding:18px}
h1{color:var(--accent);text-align:center;margin:6px 0 18px}
.container{max-width:1200px;margin:0 auto}
.controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:12px;align-items:center}
.btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
.btn.ghost{background:#fff;color:var(--text);border:1px solid var(--border)}
.card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,0.04)}
.details{margin-bottom:8px}
details summary{background:linear-gradient(90deg,var(--accent),#36b0ff);color:#fff;padding:12px;border-radius:6px;cursor:pointer}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border:1px solid var(--border);padding:8px;text-align:left;font-size:13px;vertical-align:middle}
.table th{background:#f3f6f9}
.progress{height:12px;background:#eee;border-radius:8px;overflow:hidden}
.progress > span{height:100%;display:block;background:linear-gradient(90deg,#36d07b,#7c8cff);width:0%}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#fff;border:1px solid var(--border);font-size:13px}
.small{font-size:13px}
.footer{color:#666;text-align:center;margin-top:18px;font-size:13px}
.refresh-btn{background:none;border:0;font-size:20px;cursor:pointer}
.note{width:100%;padding:6px;border:1px solid var(--border);border-radius:6px}
.row-overdue{background:linear-gradient(90deg, rgba(255,107,107,0.06), rgba(255,107,107,0.02));}
.row-due-soon{background:linear-gradient(90deg, rgba(255,184,107,0.05), rgba(255,184,107,0.02));}
.row-done{background:linear-gradient(90deg, rgba(54,208,123,0.06), rgba(124,140,255,0.02));}
.date-cell{white-space:nowrap;font-size:13px}
.note-field{width:100%}
.star{color:#f5b301;margin-left:6px;font-size:14px}
.legend{font-size:13px;color:#444}
.subtopic-wrap{display:flex;align-items:center;gap:8px}
.subtopic-name{flex:1}
@media (max-width:760px){.table th,.table td{font-size:12px}}
</style>
</head>
<body>
<div class="container">
  <h1>GATE EEE Tracker â€” Nov 25, 2025 â†’ Feb 02, 2026
    <button class="refresh-btn" title="Reload" onclick="location.reload()">ðŸ”„</button>
  </h1>

  <div class="controls">
    <button class="btn" id="exportCsv">Export CSV</button>
    <label class="btn ghost" id="importLabel" style="cursor:pointer">
      Import CSV
      <input type="file" id="fileInput" accept=".csv" style="display:none">
    </label>
    <button class="btn ghost" id="clearStorage">Reset All</button>
    <button class="btn ghost" id="copySummary">Copy Summary</button>

    <div id="liveStats" class="small" style="align-self:center"></div>

    <div class="legend" style="margin-left:12px">
      <strong>Legend:</strong> <span style="margin-left:8px">â˜… = important</span>, <span style="margin-left:8px">â˜…â˜… = very important</span>
      <div style="margin-top:4px">Study: <b>Nov 25, 2025 â†’ Feb 02, 2026</b>. Final revision: <b>Feb 03 â†’ Feb 13, 2026</b>.</div>
    </div>
  </div>

  <div id="summaryCard" class="card">
    <h3 style="margin:0 0 8px">Progress Summary</h3>
    <div id="summaryTableWrap"></div>
    <div style="margin-top:8px;color:#333" id="practiceInfo"></div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">Study Blocks (Nov 25 â†’ Feb 02)</h3>
    <p class="small">Daily: <b>Mathematics â€” 30 min (parallel)</b></p>
    <table class="table">
      <thead><tr><th>Subject</th><th>Start Date</th><th>End Date</th></tr></thead>
      <tbody>
        <tr><td>Power Systems</td><td>2025-11-25</td><td>2025-12-08</td></tr>
        <tr><td>Electrical Machines</td><td>2025-12-09</td><td>2025-12-20</td></tr>
        <tr><td>Networks</td><td>2025-12-21</td><td>2025-12-30</td></tr>
        <tr><td>Power Electronics</td><td>2025-12-31</td><td>2026-01-07</td></tr>
        <tr><td>Control Systems</td><td>2026-01-08</td><td>2026-01-15</td></tr>
        <tr><td>Signals & Systems</td><td>2026-01-16</td><td>2026-01-21</td></tr>
        <tr><td>EMF / EMI</td><td>2026-01-22</td><td>2026-01-27</td></tr>
        <tr><td>Catch-up & Weak-area polish</td><td>2026-01-28</td><td>2026-02-02</td></tr>
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">Math â€” Daily Plan (Nov 25 â†’ Dec 24)</h3>
    <p class="small">Daily mathematics practice (parallel): <b>variable duration 30 / 45 / 60 minutes</b>. Reference syllabus: <a href="/mnt/data/EE_2026_Syllabus.pdf">EE_2026_Syllabus.pdf</a></p>
    <table class="table">
      <thead><tr><th>Date</th><th>Topic</th><th>Time</th></tr></thead>
      <tbody>
        <tr><td>2025-11-25</td><td>Linear algebra: matrix ops, rank</td><td>30 min</td></tr>
        <tr><td>2025-11-26</td><td>Linear systems & Gaussian elimination</td><td>30 min</td></tr>
        <tr><td>2025-11-27</td><td>Eigenvalues & eigenvectors</td><td>60 min</td></tr>
        <tr><td>2025-11-28</td><td>LU decomposition, intro to SVD</td><td>45 min</td></tr>
        <tr><td>2025-11-29</td><td>Vector spaces & linear independence</td><td>45 min</td></tr>
        <tr><td>2025-11-30</td><td>Calculus: differentiation (max/min)</td><td>30 min</td></tr>
        <tr><td>2025-12-01</td><td>Taylor & Maclaurin series</td><td>45 min</td></tr>
        <tr><td>2025-12-02</td><td>Multivariable: partial derivatives & gradients</td><td>45 min</td></tr>
        <tr><td>2025-12-03</td><td>Multiple integrals & Jacobian</td><td>60 min</td></tr>
        <tr><td>2025-12-04</td><td>ODEs: first-order linear equations</td><td>30 min</td></tr>
        <tr><td>2025-12-05</td><td>ODEs: higher-order linear with constant coefficients</td><td>45 min</td></tr>
        <tr><td>2025-12-06</td><td>Laplace transform basics & tables</td><td>60 min</td></tr>
        <tr><td>2025-12-07</td><td>Fourier series (trig series)</td><td>60 min</td></tr>
        <tr><td>2025-12-08</td><td>Complex: Cauchy-Riemann & analytic functions</td><td>45 min</td></tr>
        <tr><td>2025-12-09</td><td>Complex integrals & residues</td><td>60 min</td></tr>
        <tr><td>2025-12-10</td><td>Probability basics: conditional prob & Bayes</td><td>45 min</td></tr>
        <tr><td>2025-12-11</td><td>Random variables & expectation</td><td>45 min</td></tr>
        <tr><td>2025-12-12</td><td>Common distributions: binomial, normal</td><td>60 min</td></tr>
        <tr><td>2025-12-13</td><td>Vector calculus: divergence & curl</td><td>30 min</td></tr>
        <tr><td>2025-12-14</td><td>Numerical methods: Newton-Raphson</td><td>45 min</td></tr>
        <tr><td>2025-12-15</td><td>Numerical integration: Simpson & trapezoid</td><td>45 min</td></tr>
        <tr><td>2025-12-16</td><td>Linear algebra mixed quiz</td><td>60 min</td></tr>
        <tr><td>2025-12-17</td><td>Laplace for ODE practice</td><td>45 min</td></tr>
        <tr><td>2025-12-18</td><td>Probability MCQs (timed)</td><td>60 min</td></tr>
        <tr><td>2025-12-19</td><td>Fourier & Laplace mix</td><td>45 min</td></tr>
        <tr><td>2025-12-20</td><td>Complex residues practice</td><td>45 min</td></tr>
        <tr><td>2025-12-21</td><td>Gradient & Lagrange multipliers</td><td>60 min</td></tr>
        <tr><td>2025-12-22</td><td>Numerical methods review & error analysis</td><td>45 min</td></tr>
        <tr><td>2025-12-23</td><td>Mixed mini-test (linear alg + calc + prob)</td><td>60 min</td></tr>
        <tr><td>2025-12-24</td><td>Consolidation: 1-page math cheat sheet</td><td>30 min</td></tr>
      </tbody>
    </table>
    <p class="small">Notes: You can shift any heavy (60min) day to a lighter day if you feel overloaded. The syllabus PDF is attached for reference: <a href="/mnt/data/EE_2026_Syllabus.pdf">EE_2026_Syllabus.pdf</a></p>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">General Aptitude â€” Daily Plan (Jan 01 â†’ Feb 01)</h3>
    <p class="small">Daily: <b>30 minutes</b> (rotating Verbal â†’ Quant â†’ Reasoning â†’ DI)</p>
    <table class="table">
      <thead><tr><th>Date</th><th>Topic</th><th>Notes</th></tr></thead>
      <tbody>
        <tr><td>2026-01-01</td><td>Verbal â€” Grammar basics</td><td></td></tr>
        <tr><td>2026-01-02</td><td>Quant â€” Number systems</td><td></td></tr>
        <tr><td>2026-01-03</td><td>Reasoning â€” Series & patterns</td><td></td></tr>
        <tr><td>2026-01-04</td><td>Data Interpretation â€” Tables & charts</td><td></td></tr>
        <tr><td>2026-01-05</td><td>Verbal â€” Para jumbles</td><td></td></tr>
        <tr><td>2026-01-06</td><td>Quant â€” Algebra basics</td><td></td></tr>
        <tr><td>2026-01-07</td><td>Reasoning â€” Blood relations</td><td></td></tr>
        <tr><td>2026-01-08</td><td>DI â€” Percentages in DI</td><td></td></tr>
        <tr><td>2026-01-09</td><td>Verbal â€” Reading comprehension (Set 1)</td><td></td></tr>
        <tr><td>2026-01-10</td><td>Quant â€” Ratios & proportions</td><td></td></tr>
        <tr><td>2026-01-11</td><td>Reasoning â€” Coding-decoding</td><td></td></tr>
        <tr><td>2026-01-12</td><td>DI â€” Simple graphs</td><td></td></tr>
        <tr><td>2026-01-13</td><td>Verbal â€” Vocabulary (syn/ant)</td><td></td></tr>
        <tr><td>2026-01-14</td><td>Quant â€” Time & work</td><td></td></tr>
        <tr><td>2026-01-15</td><td>Reasoning â€” Directions</td><td></td></tr>
        <tr><td>2026-01-16</td><td>DI â€” Mixed sets</td><td></td></tr>
        <tr><td>2026-01-17</td><td>Verbal â€” Error spotting</td><td></td></tr>
        <tr><td>2026-01-18</td><td>Quant â€” Percentages</td><td></td></tr>
        <tr><td>2026-01-19</td><td>Reasoning â€” Analogies</td><td></td></tr>
        <tr><td>2026-01-20</td><td>DI â€” Combined DI</td><td></td></tr>
        <tr><td>2026-01-21</td><td>Verbal â€” Synonyms/antonyms practice</td><td></td></tr>
        <tr><td>2026-01-22</td><td>Quant â€” Time/speed/distance</td><td></td></tr>
        <tr><td>2026-01-23</td><td>Reasoning â€” Non-verbal</td><td></td></tr>
        <tr><td>2026-01-24</td><td>DI â€” Caselets</td><td></td></tr>
        <tr><td>2026-01-25</td><td>Verbal â€” Reading comprehension (Set 2)</td><td></td></tr>
        <tr><td>2026-01-26</td><td>Quant â€” Profit & loss</td><td></td></tr>
        <tr><td>2026-01-27</td><td>Reasoning â€” Puzzles</td><td></td></tr>
        <tr><td>2026-01-28</td><td>DI â€” Data comparison</td><td></td></tr>
        <tr><td>2026-01-29</td><td>Verbal â€” Cloze test</td><td></td></tr>
        <tr><td>2026-01-30</td><td>Quant â€” Mixed practice set</td><td></td></tr>
        <tr><td>2026-01-31</td><td>Reasoning â€” Combined reasoning test</td><td></td></tr>
        <tr><td>2026-02-01</td><td>DI â€” Revision + speed test</td><td></td></tr>
      </tbody>
    </table>
    <p class="small">Reference syllabus uploaded: <a href="/mnt/data/GATE _GA_2025_Syllabus.pdf">GATE_GA_2025_Syllabus.pdf</a></p>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">Amplitude â€” Subject Allocation (Nov 25 â†’ Feb 02)</h3>
    <p class="small">This table shows the day-allocation per subject (total 70 days). Mathematics remains parallel (30 min daily).</p>
    <table class="table">
      <thead><tr><th>Subject</th><th>Allocated Days</th><th>Start Date</th><th>End Date</th></tr></thead>
      <tbody>
        <tr><td>Power Systems</td><td>14</td><td>2025-11-25</td><td>2025-12-08</td></tr>
        <tr><td>Electrical Machines</td><td>12</td><td>2025-12-09</td><td>2025-12-20</td></tr>
        <tr><td>Networks</td><td>10</td><td>2025-12-21</td><td>2025-12-30</td></tr>
        <tr><td>Power Electronics</td><td>8</td><td>2025-12-31</td><td>2026-01-07</td></tr>
        <tr><td>Control Systems</td><td>8</td><td>2026-01-08</td><td>2026-01-15</td></tr>
        <tr><td>Signals & Systems</td><td>6</td><td>2026-01-16</td><td>2026-01-21</td></tr>
        <tr><td>EMF</td><td>6</td><td>2026-01-22</td><td>2026-01-27</td></tr>
        <tr><td>Measurements</td><td>3</td><td>2026-01-28</td><td>2026-01-30</td></tr>
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">Full Syllabus â€” Target dates & importance (EEE)</h3>

    <!-- Power Systems -->
    <details open class="details">
      <summary><b>Power Systems</b></summary>
      <table class="table" id="topic-Power Systems">
        <thead><tr><th>Subtopic</th><th style="width:90px">Important</th><th style="width:100px">Completed</th><th style="width:100px">Revised</th><th style="width:110px">Practiced</th><th style="width:120px">Target Date</th><th style="width:130px">Rev 1</th><th style="width:130px">Final Rev</th><th>Notes</th></tr></thead>
        <tbody></tbody>
      </table>
    </details>

    <!-- Electrical Machines -->
    <details open class="details">
      <summary><b>Electrical Machines</b></summary>
      <table class="table" id="topic-Electrical Machines"><thead><tr><th>Subtopic</th><th style="width:90px">Important</th><th style="width:100px">Completed</th><th style="width:100px">Revised</th><th style="width:110px">Practiced</th><th style="width:120px">Target Date</th><th style="width:130px">Rev 1</th><th style="width:130px">Final Rev</th><th>Notes</th></tr></thead><tbody></tbody></table>
    </details>

    <!-- Networks (Circuits) -->
    <details open class="details">
      <summary><b>Networks / Circuit Theory</b></summary>
      <table class="table" id="topic-Networks"><thead><tr><th>Subtopic</th><th style="width:90px">Important</th><th style="width:100px">Completed</th><th style="width:100px">Revised</th><th style="width:110px">Practiced</th><th style="width:120px">Target Date</th><th style="width:130px">Rev 1</th><th style="width:130px">Final Rev</th><th>Notes</th></tr></thead><tbody></tbody></table>
    </details>

    <!-- Control Systems -->
    <details open class="details">
      <summary><b>Control Systems</b></summary>
      <table class="table" id="topic-Control Systems"><thead><tr><th>Subtopic</th><th style="width:90px">Important</th><th style="width:100px">Completed</th><th style="width:100px">Revised</th><th style="width:110px">Practiced</th><th style="width:120px">Target Date</th><th style="width:130px">Rev 1</th><th style="width:130px">Final Rev</th><th>Notes</th></tr></thead><tbody></tbody></table>
    </details>

    <!-- Power Electronics & Drives -->
    <details open class="details">
      <summary><b>Power Electronics & Drives</b></summary>
      <table class="table" id="topic-Power Electronics"><thead><tr><th>Subtopic</th><th style="width:90px">Important</th><th style="width:100px">Completed</th><th style="width:100px">Revised</th><th style="width:110px">Practiced</th><th style="width:120px">Target Date</th><th style="width:130px">Rev 1</th><th style="width:130px">Final Rev</th><th>Notes</th></tr></thead><tbody></tbody></table>
    </details>

    <!-- Signals & Systems -->
    <details open class="details">
      <summary><b>Signals & Systems</b></summary>
      <table class="table" id="topic-Signals & Systems"><thead><tr><th>Subtopic</th><th style="width:90px">Important</th><th style="width:100px">Completed</th><th style="width:100px">Revised</th><th style="width:110px">Practiced</th><th style="width:120px">Target Date</th><th style="width:130px">Rev 1</th><th style="width:130px">Final Rev</th><th>Notes</th></tr></thead><tbody></tbody></table>
    </details>

    <!-- EM Field Theory -->
    <details open class="details">
      <summary><b>Electromagnetic Fields</b></summary>
      <table class="table" id="topic-EMF"><thead><tr><th>Subtopic</th><th style="width:90px">Important</th><th style="width:100px">Completed</th><th style="width:100px">Revised</th><th style="width:110px">Practiced</th><th style="width:120px">Target Date</th><th style="width:130px">Rev 1</th><th style="width:130px">Final Rev</th><th>Notes</th></tr></thead><tbody></tbody></table>
    </details>

    <!-- Measurements -->
    <details open class="details">
      <summary><b>Measurements</b></summary>
      <table class="table" id="topic-Measurements"><thead><tr><th>Subtopic</th><th style="width:90px">Important</th><th style="width:100px">Completed</th><th style="width:100px">Revised</th><th style="width:110px">Practiced</th><th style="width:120px">Target Date</th><th style="width:130px">Rev 1</th><th style="width:130px">Final Rev</th><th>Notes</th></tr></thead><tbody></tbody></table>
    </details>


  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">Controls & Notes</h3>
    <ul>
      <li>Study window: <b>Nov 25, 2025 â†’ Feb 02, 2026</b>. Final revision window: <b>Feb 03 â†’ Feb 13, 2026</b>.</li>
      <li>Tracker tailored for <b>GATE EEE</b>: Power Systems, Electrical Machines, Networks, Control Systems, Power Electronics & Drives, Signals & Systems, EMF, Measurements .</li>
      <li>Dates are assigned automatically and saved locally in your browser. Use Export/Import to move progress between devices.</li>
    </ul>
  </div>

  <div class="footer">Saved locally in browser. Want this exported as CSV or a printable checklist? Click Export CSV.</div>
</div>

<script>
/* -------------------------
   Expanded EEE syllabus arrays (subtopics) â€” improved clarity
------------------------- */
window.PS = [
  'Per-unit system & single-line diagrams',
  'Transmission line models: short/medium/long',
  'Shunt & series compensation, Ferranti effect',
  'Power flow: Ybus formation & Gauss-Seidel',
  'Power flow: Newton-Raphson & solution tips',
  'Symmetrical components & sequence networks',
  'Fault analysis: LG, LL, LLG examples',
  'Protection basics: relays, CT/PT, settings',
  'Economic dispatch & incremental cost curve',
  'Stability concepts: swing equation & equal area'
];

window.MACH = [
  'Transformer equivalent circuit & phasors',
  'Transformer tests: open-circuit & short-circuit',
  'Transformer connections, vector groups & parallel operation',
  'DC machines: construction & characteristics',
  'DC machine control: armature/field control',
  'Three-phase induction motor: equivalent circuit',
  'Induction motor performance & torque-speed curve',
  'Synchronous machines: operation & V-curves',
  'Starting and braking methods (DC/AC)',
  'Machine testing, losses & efficiency calculations'
];

window.NET = [
  'Basic network elements & phasors',
  'Node/mesh analysis with examples',
  'Thevenin, Norton, Superposition proofs & practice',
  'Transient analysis & time constants (RC/RL/RLC)',
  'Laplace transform applications in circuits',
  'Two-port networks: parameters & cascading',
  'Resonance, steady-state AC analysis, Q-factor',
  'Balanced three-phase circuits & star-delta',
  'Circuit synthesis basics & example problems',
  'Network theorems: maximum power transfer'
];

window.CTRL = [
  'Transfer functions & block diagram reduction',
  'Time-domain response: 1st & 2nd order systems',
  'Steady-state errors & system type',
  'Stability: Routh-Hurwitz method',
  'Root locus design basics & examples',
  'Frequency response: Bode plot interpretation',
  'Nyquist criterion & gain/phase margins',
  'Compensator design: lead/lag & PID tuning'
];

window.PE = [
  'Diode & thyristor characteristics & circuits',
  'Controlled rectifiers: firing and commutation',
  'DC-DC converters: Buck / Boost / Buck-Boost',
  'Inverters: single/three-phase & PWM basics',
  'Choppers, converters & switching waveforms',
  'Harmonics, power factor & filter basics',
  'Voltage regulation & snubber/filter design',
  'Drives: DC & AC drives overview and control'
];

window.SS = [
  'Signals: continuous & discrete descriptions',
  'LTI systems & convolution (time and freq view)',
  'Fourier series & Fourier transform essentials',
  'Laplace transform: ROC and inverse methods',
  'Sampling theorem, aliasing & anti-aliasing',
  'Z-transform basics & difference equation solutions',
  'RMS/average calculations & energy of signals'
];

window.EMF = [
  'Electrostatics: Gauss law & field distributions',
  'Capacitance of simple geometries & dielectrics',
  'Magnetostatics: Biot-Savart & Ampereâ€™s law',
  'Inductance, mutual inductance & magnetic circuits',
  'Maxwell equations (integral form) & implications',
  'Wave equations, TEM modes & EM wave basics'
];

window.MEAS = [
  'Measurement of voltage & current: instruments & ranges',
  'Instrument transformers: CTs and PTs, accuracy classes',
  'Bridges and potentiometers: Wheatstone & Kelvin',
  'Digital measurement techniques: ADCs, multimeters, error sources',
  'Transducers & sensors: strain gauges, RTDs, thermocouples',
  'Error analysis, calibration methods & uncertainty estimation'
];


/* -------------------------
   IMPORTANCE (0,1,2) â€” lengths must match subtopic arrays above
------------------------- */
const IMPORTANCE = {
  'Power Systems':       [2,1,1,2,2,1,2,1,1,1],
  'Electrical Machines': [2,2,1,2,1,1,1,2,1,1],
  'Networks':            [1,1,2,2,2,1,1,1,1,1],
  'Control Systems':     [2,2,1,1,1,1,1,2],
  'Power Electronics':   [1,2,1,1,1,1,1,1],
  'Signals & Systems':   [1,1,2,2,1,1,1],
  'EMF':                 [1,1,1,1,2,1],
  'Measurements':        [2,2,1,1,1,1],

};

/* -------------------------
   Scheduling config: add Measurements days and distribute remaining days.
   NOTE: keep total study window unchanged; tweak numbers to include Measurements.
------------------------- */
const studyStart = new Date('2025-11-25'); // inclusive
const studyEnd   = new Date('2026-02-02'); // inclusive
const finalRevWindowStart = new Date('2026-02-03');
const finalRevWindowEnd = new Date('2026-02-13T00:00:00');
const rev1OffsetDays = 10;

const amplitude = {
  'Power Systems': 14,
  'Electrical Machines': 12,
  'Networks': 10,
  'Power Electronics': 8,
  'Control Systems': 8,
  'Signals & Systems': 6,
  'EMF': 6,
  'Measurements': 3,          // <-- added schedule days for Measurements

};

/* storage prefix & helpers */
const canonicalPrefix = 'GATE_EEE::';
function makeKey(topic, idx, type){ return `${canonicalPrefix}${topic}::${idx}::${type}`; }
function addDays(d,n){ const x=new Date(d.getTime()); x.setDate(x.getDate()+n); return x; }
function formatDate(d){ if(!d) return ''; return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }

/* -------------------------
   Topic normalization helper
------------------------- */
function topicKeyFromSummary(summary){
  const s = (summary||'').toLowerCase();
  if (s.includes('power systems')) return 'Power Systems';
  if (s.includes('electrical machines')) return 'Electrical Machines';
  if (s.includes('network') || s.includes('circuit')) return 'Networks';
  if (s.includes('control')) return 'Control Systems';
  if (s.includes('power electronics') || s.includes('drives')) return 'Power Electronics';
  if (s.includes('signals')) return 'Signals & Systems';
  if (s.includes('electromagnetic') || s.includes('emf')) return 'EMF';
  if (s.includes('measurement') || s.includes('instrument')) return 'Measurements';

  return summary;
}

/* -------------------------
   Render helpers
------------------------- */
function renderTopicArray(topic, arr){
  const table = document.getElementById('topic-'+topic);
  if (!table) return;
  const tbody = table.querySelector('tbody');
  tbody.innerHTML = '';
  const impArr = IMPORTANCE[topic] || [];
  if (impArr.length && impArr.length !== arr.length){
    console.warn(`IMPORTANCE length (${impArr.length}) for "${topic}" does not match subtopic count (${arr.length}). Missing entries will be treated as 0.`);
  }
  arr.forEach((s, i)=>{
    const imp = impArr[i] || 0;
    let starHtml = '';
    if (imp === 1) starHtml = '<span class="star" title="Important">â˜…</span>';
    else if (imp === 2) starHtml = '<span class="star" title="Very important">â˜…â˜…</span>';
    const tr = document.createElement('tr');
    tr.dataset.topic = topic;
    tr.dataset.idx = i;
    tr.innerHTML = `<td><div class="subtopic-wrap"><div class="subtopic-name">${s}</div>${starHtml}</div></td>
      <td style="text-align:center">${imp>0? (imp===2?'â˜…â˜…':'â˜…') : ''}</td>
      <td style="text-align:center"><input type='checkbox' class='completed'></td>
      <td style="text-align:center"><input type='checkbox' class='revised'></td>
      <td style="text-align:center"><input type='checkbox' class='practiced'></td>
      <td class="date-cell" style="text-align:center"></td>
      <td class="date-cell" style="text-align:center"></td>
      <td class="date-cell" style="text-align:center"></td>
      <td style="text-align:left"><input type="text" class="note note-field" placeholder="notes..."></td>`;
    tbody.appendChild(tr);
  });
}

function allSchedulableEntries(){
  const groups = [
    ['Power Systems', window.PS || []],
    ['Electrical Machines', window.MACH || []],
    ['Networks', window.NET || []],
    ['Control Systems', window.CTRL || []],
    ['Power Electronics', window.PE || []],
    ['Signals & Systems', window.SS || []],
    ['EMF', window.EMF || []],
    ['Measurements', window.MEAS || []],
  ];
  const out=[];
  groups.forEach(g=>{
    const tname=g[0], arr=g[1];
    arr.forEach((s,i)=> out.push({topic:tname, subtopic:s, index:i}));
  });
  return out;
}

function computeSubjectBlocks(amps, startDate){
  const blocks = {};
  let cursor = new Date(startDate.getTime());
  const keys = Object.keys(amps);
  for(const k of keys){
    const days = Math.max(1, Math.floor(amps[k]));
    const blockStart = new Date(cursor.getTime());
    const blockEnd = addDays(blockStart, days - 1);
    blocks[k] = {start:blockStart, end:blockEnd, days};
    cursor = addDays(blockEnd, 1);
  }
  return blocks;
}

function assignTargetDates(){
  const entries = allSchedulableEntries();
  const map = {};
  if (entries.length === 0) return map;

  const blocks = computeSubjectBlocks(amplitude, studyStart);

  const byTopic = {};
  entries.forEach(e=>{
    if (!byTopic[e.topic]) byTopic[e.topic] = [];
    byTopic[e.topic].push(e);
  });

  Object.keys(byTopic).forEach(topic=>{
    const list = byTopic[topic];
    const block = blocks[topic];
    if (!block){
      const totalDays = Math.floor((studyEnd - studyStart)/(1000*60*60*24)) + 1;
      list.forEach((item, idx)=>{
        const frac = idx / (list.length - 1 || 1);
        const dayOffset = Math.round(frac * (totalDays - 1));
        const target = addDays(studyStart, dayOffset);
        const rev1 = addDays(target, rev1OffsetDays);
        map[`${item.topic}::${item.index}`] = {target, rev1};
      });
    } else {
      const spanDays = Math.max(1, Math.floor((block.end - block.start)/(1000*60*60*24)) + 1);
      for(let i=0;i<list.length;i++){
        const frac = i / (list.length - 1 || 1);
        const offset = Math.round(frac * (spanDays - 1));
        const target = addDays(block.start, offset);
        const rev1 = addDays(target, rev1OffsetDays);
        map[`${list[i].topic}::${list[i].index}`] = {target, rev1};
      }
    }
  });

  const finalWindowDays = [];
  for(let d=0; d<=Math.floor((finalRevWindowEnd - finalRevWindowStart)/(1000*60*60*24)); d++){
    finalWindowDays.push(addDays(finalRevWindowStart, d));
  }
  const keys = Object.keys(map);
  for(let i=0;i<keys.length;i++){
    map[keys[i]].finalRev = finalWindowDays[i % finalWindowDays.length];
  }
  return map;
}

/* populate dates into visible tables */
function populateDates(mapping){
  document.querySelectorAll('details').forEach(section=>{
    const visibleTopic = section.querySelector('summary').textContent.trim();
    const topicKey = topicKeyFromSummary(visibleTopic); // normalize visible -> internal key
    Array.from(section.querySelectorAll('tbody tr')).forEach((row, idx)=>{
      const key = `${topicKey}::${idx}`;
      const cellTarget = row.cells[5];
      const cellRev1 = row.cells[6];
      const cellFinal = row.cells[7];
      const m = mapping[key];
      if (!m){
        cellTarget.textContent = 'â€”';
        cellRev1.textContent = 'â€”';
        cellFinal.textContent = 'â€”';
        row.dataset.target = '';
        row.dataset.rev1 = '';
        row.dataset.final = '';
      } else {
        cellTarget.textContent = formatDate(m.target);
        cellRev1.textContent = formatDate(m.rev1);
        cellFinal.textContent = formatDate(m.finalRev);
        row.dataset.target = formatDate(m.target);
        row.dataset.rev1 = formatDate(m.rev1);
        row.dataset.final = formatDate(m.finalRev);
      }
    });
  });
}

function applyRowColoring(){
  const today = new Date();
  document.querySelectorAll('details tbody tr').forEach(row=>{
    row.classList.remove('row-overdue','row-due-soon','row-done');
    const completed = row.querySelector('.completed') && row.querySelector('.completed').checked;
    const targetStr = row.dataset.target;
    if (!targetStr || targetStr==='') return;
    const parts = targetStr.split('-').map(Number);
    const tDate = new Date(parts[0], parts[1]-1, parts[2]);
    const daysTo = Math.floor((tDate - today)/(1000*60*60*24));
    if (completed){
      row.classList.add('row-done');
    } else if (daysTo < 0){
      row.classList.add('row-overdue');
    } else if (daysTo <= 3){
      row.classList.add('row-due-soon');
    }
  });
}

function saveStates(){
  document.querySelectorAll('details').forEach(section=>{
    const visibleTopic = section.querySelector('summary')?.textContent?.trim() || 'unknown';
    const topicKey = topicKeyFromSummary(visibleTopic);
    Array.from(section.querySelectorAll('tbody tr')).forEach((row, idx)=>{
      ['completed','revised','practiced'].forEach(type=>{
        const cb = row.querySelector('.'+type);
        if (!cb) return;
        try{ localStorage.setItem(makeKey(topicKey, idx, type), cb.checked ? '1' : '0'); }catch(e){}
      });
      const note = row.querySelector('.note-field');
      if (note){
        try{ localStorage.setItem(makeKey(topicKey, idx, 'note'), note.value || ''); }catch(e){}
      }
    });
  });
}
function loadStates(){
  document.querySelectorAll('details').forEach(section=>{
    const visibleTopic = section.querySelector('summary')?.textContent?.trim() || 'unknown';
    const topicKey = topicKeyFromSummary(visibleTopic);
    Array.from(section.querySelectorAll('tbody tr')).forEach((row, idx)=>{
      ['completed','revised','practiced'].forEach(type=>{
        const cb = row.querySelector('.'+type);
        if (!cb) return;
        const v = localStorage.getItem(makeKey(topicKey, idx, type));
        cb.checked = v === '1';
      });
      const note = row.querySelector('.note-field');
      if (note){
        const nv = localStorage.getItem(makeKey(topicKey, idx, 'note'));
        if (nv !== null) note.value = nv;
      }
    });
  });
}

function updateSummary(){
  saveStates();
  const rows = [];
  document.querySelectorAll('details').forEach(section=>{
    const visible = section.querySelector('summary').textContent.trim();
    const trs = Array.from(section.querySelectorAll('tbody tr'));
    const total = trs.length;
    let comp=0, rev=0, prac=0;
    trs.forEach(r=>{ if (r.querySelector('.completed')?.checked) comp++; if (r.querySelector('.revised')?.checked) rev++; if (r.querySelector('.practiced')?.checked) prac++; });
    rows.push(`<tr><td>${visible}</td><td style='text-align:center'>${total}</td><td style='text-align:center'>${comp}</td><td style='text-align:center'>${rev}</td><td style='text-align:center'>${prac}</td><td style='text-align:center'>${total?((comp/total)*100).toFixed(1):'0.0'}%</td><td style='text-align:center'>${total?((rev/total)*100).toFixed(1):'0.0'}%</td><td style='text-align:center'>${total?((prac/total)*100).toFixed(1):'0.0'}%</td></tr>`);
  });
  const allRows = Array.from(document.querySelectorAll('details tbody tr'));
  const grandTotal = allRows.length || 1;
  let gC=0,gR=0,gP=0; allRows.forEach(r=>{ if (r.querySelector('.completed')?.checked) gC++; if (r.querySelector('.revised')?.checked) gR++; if (r.querySelector('.practiced')?.checked) gP++; });
  const grand = `<tr class='grand'><td><b>Grand Total</b></td><td style='text-align:center'>${grandTotal}</td><td style='text-align:center'>${gC}</td><td style='text-align:center'>${gR}</td><td style='text-align:center'>${gP}</td><td style='text-align:center'>${((gC/grandTotal)*100).toFixed(1)}%</td><td style='text-align:center'>${((gR/grandTotal)*100).toFixed(1)}%</td><td style='text-align:center'>${((gP/grandTotal)*100).toFixed(1)}%</td></tr>`;
  document.getElementById('summaryTableWrap').innerHTML = `<table class='table'><thead><tr><th>Main Topic</th><th>Total Subtopics</th><th>Completed</th><th>Revised</th><th>Practiced</th><th>%C</th><th>%R</th><th>%P</th></tr></thead><tbody>${rows.join('')} ${grand}</tbody></table>`;
  const live = document.getElementById('liveStats');
  if (live) live.textContent = `Completed ${gC}/${grandTotal} Â· Revised ${gR} Â· Practiced ${gP}`;
  applyRowColoring();
}

function exportCSV(){
  const rows=[];
  document.querySelectorAll('details').forEach(section=>{
    const visibleTopic = section.querySelector('summary')?.textContent?.trim() || '';
    const topicKey = topicKeyFromSummary(visibleTopic);
    Array.from(section.querySelectorAll('tbody tr')).forEach((row, idx)=>{
      const sub = (row.querySelector('td')?.textContent || '').trim().replace(/\n/g,' ');
      const imp = IMPORTANCE[topicKey] && IMPORTANCE[topicKey][idx] ? IMPORTANCE[topicKey][idx] : 0;
      const comp = row.querySelector('.completed')?.checked ? '1':'0';
      const rev = row.querySelector('.revised')?.checked ? '1':'0';
      const prac = row.querySelector('.practiced')?.checked ? '1':'0';
      const targ = row.dataset.target || '';
      const note = (row.querySelector('.note-field')?.value || '').replace(/"/g,'""');
      rows.push([visibleTopic, topicKey, idx, sub, imp, comp, rev, prac, targ, note].map(v=>`"${String(v).replace(/"/g,'""')}"`).join(','));
    });
  });
  const csv = 'visible_topic,internal_topic,idx,subtopic,importance,completed,revised,practiced,target_date,note\n' + rows.join('\n');
  const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='gate_eee_export.csv'; a.click(); URL.revokeObjectURL(url);
}

function importCSVFile(file){
  const reader=new FileReader();
  reader.onload = e=>{
    const text = e.target.result;
    const rows = parseCSV(text);
    let start = 0;
    if (rows.length>0){
      const headers = rows[0].map(h=>String(h||'').toLowerCase());
      if (headers.includes('visible_topic') && headers.includes('subtopic')) start = 1;
    }
    for(let r=start;r<rows.length;r++){
      const parts = rows[r];
      if (!parts || parts.length < 9) continue;
      const visible = (parts[0]||'').replace(/""/g,'"');
      const internal = (parts[1]||'').replace(/""/g,'"');
      const idx = parseInt((parts[2]||'').replace(/^"|"$/g,''),10);
      const imp = parseInt((parts[4]||'').replace(/^"|"$/g,''),10) || 0;
      const comp = String(parts[5]||'').replace(/^"|"$/g,'') === '1';
      const rev = String(parts[6]||'').replace(/^"|"$/g,'') === '1';
      const prac = String(parts[7]||'').replace(/^"|"$/g,'') === '1';
      const targ = parts[8] ? String(parts[8]||'').replace(/^"|"$/g,'').replace(/""/g,'"') : '';
      const note = parts[9] ? String(parts[9]||'').replace(/^"|"$/g,'').replace(/""/g,'"') : '';
      if (IMPORTANCE[internal]) IMPORTANCE[internal][idx] = imp;
      const details = Array.from(document.querySelectorAll('details'));
      let section = details.find(d => (d.querySelector('summary')?.textContent||'').trim() === visible);
      if (!section) section = details.find(d => (d.querySelector('summary')?.textContent||'').toLowerCase().includes((internal||'').toLowerCase()));
      if (!section) continue;
      const row = section.querySelectorAll('tbody tr')[idx];
      if (!row) continue;
      if (row.querySelector('.completed')) row.querySelector('.completed').checked = comp;
      if (row.querySelector('.revised')) row.querySelector('.revised').checked = rev;
      if (row.querySelector('.practiced')) row.querySelector('.practiced').checked = prac;
      if (row.querySelector('.note-field')) row.querySelector('.note-field').value = note;
      if (targ) row.dataset.target = targ;
    }
    const groups = [
      ['Power Systems', window.PS || []],
      ['Electrical Machines', window.MACH || []],
      ['Networks', window.NET || []],
      ['Control Systems', window.CTRL || []],
      ['Power Electronics', window.PE || []],
      ['Signals & Systems', window.SS || []],
      ['EMF', window.EMF || []],
      ['Measurements', window.MEAS || []],
    ];
    groups.forEach(g=> renderTopicArray(g[0], g[1]));
    updateSummary();
    alert('Import finished.');
  };
  reader.readAsText(file);
}

function parseCSV(text){
  const rows = [];
  let i=0, len=text.length;
function parseCSV(text){
  const rows = [];
  let i=0, len=text.length;
  let row=[], field='';
  let inQuotes=false;
  while(i < len){
    const ch = text[i];
    if (inQuotes){
      if (ch === '"'){
        if (i+1 < len && text[i+1] === '"'){ field += '"'; i+=2; continue; }
        else { inQuotes = false; i++; continue; }
      } else { field += ch; i++; continue; }
    } else {
      if (ch === '"'){ inQuotes = true; i++; continue; }
      if (ch === ','){ row.push(field); field=''; i++; continue; }
      if (ch === '\r'){ i++; continue; }
      if (ch === '\n'){ row.push(field); rows.push(row); row=[]; field=''; i++; continue; }
      field += ch; i++; continue;
    }
  }
  if (field !== '' || row.length>0){ row.push(field); rows.push(row); }
  return rows;
}
  document.querySelectorAll('input[type=checkbox]').forEach(cb=>cb.checked=false);
  document.querySelectorAll('.note-field').forEach(n=>n.value='');
  Object.keys(localStorage).forEach(k=>{ if (k.startsWith(canonicalPrefix)) localStorage.removeItem(k); });
  updateSummary();
}

/* ---------- init ---------- */
window.addEventListener('load', ()=>{
  const groups = [
    ['Power Systems', window.PS || []],
    ['Electrical Machines', window.MACH || []],
    ['Networks', window.NET || []],
    ['Control Systems', window.CTRL || []],
    ['Power Electronics', window.PE || []],
    ['Signals & Systems', window.SS || []],
    ['EMF', window.EMF || []],
    ['Measurements', window.MEAS || []],

  ];
  groups.forEach(g=> renderTopicArray(g[0], g[1]));

  const mapping = assignTargetDates();
  populateDates(mapping);

  loadStates();
  updateSummary();

  document.addEventListener('change', (e)=>{ 
    if (!e.target) return;
    if (e.target.matches('input[type=checkbox]') || e.target.matches('.note-field')) { saveStates(); updateSummary(); }
  });
  document.addEventListener('input', (e)=>{ if (e.target && e.target.matches('.note-field')) saveStates(); });

  document.getElementById('exportCsv').addEventListener('click', exportCSV);
  document.getElementById('clearStorage').addEventListener('click', resetAll);
  document.getElementById('copySummary').addEventListener('click', ()=>{ navigator.clipboard?.writeText(document.getElementById('summaryTableWrap').innerText).then(()=>alert('Summary copied to clipboard')).catch(()=>alert('Could not copy')); });

  const fileInput = document.getElementById('fileInput');
  fileInput.addEventListener('change', (ev)=>{ const f=ev.target.files && ev.target.files[0]; if (f) importCSVFile(f); fileInput.value=''; });

  setInterval(applyRowColoring, 1000*60*10);

  document.querySelectorAll('.date-cell').forEach(cell=>{
    cell.addEventListener('mouseenter', (e)=>{
      const row = cell.closest('tr'); if (!row) return;
      const r1 = row.dataset.rev1 || '', rf = row.dataset.final || '';
      if (r1 || rf) cell.title = `Rev1: ${r1 || 'â€”'} â€¢ Final: ${rf || 'â€”'}`;
    });
  });
});

/* ---------- helper: resetAll ---------- */
function resetAll(){
  if (!confirm('Reset all progress and clear local storage?')) return;
  document.querySelectorAll('input[type=checkbox]').forEach(cb=>cb.checked=false);
  document.querySelectorAll('.note-field').forEach(n=>n.value='');
  Object.keys(localStorage).forEach(k=>{ if (k.startsWith(canonicalPrefix)) localStorage.removeItem(k); });
  updateSummary();
}
</script>
</body>
</html>
